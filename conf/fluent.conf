
# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY, USE /templates/conf/fluent.conf.erb

@include systemd.conf
@include kubernetes.conf
@include conf.d/*.conf

# <match kubernetes.**>
#   @type file
#   @log_level info
#   path /var/log/fluent/kube-pod-log.${$.kubernetes.container_name}.%Y%m.%Y%m%d.${$.kubernetes.container_name}.${$.kubernetes.host}.${$.kubernetes.pod_name}.%Y-%m-%d_%H-%M.log
#   <format>
#     @type single_value
#     message_key log
#   </format>
#   <buffer time,$.kubernetes.container_name, $.kubernetes.host, $.kubernetes.pod_name>
#     @type file
#     timekey 60m
#     timekey_use_utc true
#     timekey_wait 5m
#   </buffer>
# </match>


<match kubernetes.**>
  @type file
  @log_level debug
  path /var/log/fluent/kube-pod.${$.kubernetes.namespace_name}.${$.kubernetes.labels.app}.${$.kubernetes.labels.stage}.${$.kubernetes.container_name}.%Y%m.%Y%m%d.${$.kubernetes.pod_name}.${$.kubernetes.host}.%Y-%m-%d_%H-%M.${$.stream}
  <format>
    @type single_value
    message_key log
  </format>
  <buffer time, $.stream , $.kubernetes.namespace_name, $.kubernetes.labels.app, $.kubernetes.labels.stage, $.kubernetes.container_name, $.kubernetes.pod_name, $.kubernetes.host>
    timekey 30m
    timekey_use_utc false
    timekey_zone +0800
    timekey_wait 60s
    overflow_action throw_exception
    chunk_limit_size 512MB #Default: 8MB (memory) / 256MB (file)
    total_limit_size 32GB #Default: 512MB (memory) / 64GB (file)
    chunk_full_threshold 0.9 #flush the chunk when actual size reaches chunk_limit_size * chunk_full_threshold
    retry_timeout 10m
  </buffer>
</match>

<match **>
  @type file
  @log_level info
  path /var/log/fluent/kube-system-log.%Y%m.%Y%m%d.%Y-%m-%d_%H-%M.log
  <buffer>
    timekey 60m
    timekey_use_utc false
    timekey_zone +0800
    timekey_wait 3m
  </buffer>
</match>